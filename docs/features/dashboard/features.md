# Feature Breakdown: User Dashboard (/dashboard)

**Version:** 1.0
**Status:** Core Implementation (P1)

This document provides a detailed breakdown of the features constituting the Global Pulse User Dashboard (`/dashboard`), explaining their function and technical underpinnings, aligned with performance best practices.

---

### 1. Personalized Greeting

*   **Feature:** A simple, dynamic welcome message displayed prominently on the dashboard.
*   **Purpose:** To personalize the experience and acknowledge the logged-in user.
*   **Function:**
    *   **Backend/Server-Side:** The user's name or relevant identifier is fetched server-side during the page render, typically using Supabase Auth helpers (`getUser()`) within a Next.js Server Component (RSC) or layout.
    *   **Frontend:** The greeting component receives the user's name as a prop and renders a message like "Welcome back, [User Name]!".
*   **User Experience:** Creates a personalized and welcoming first impression upon landing on the dashboard.
*   **Performance:** Minimal overhead. User data fetched efficiently server-side as part of the initial request authentication/data loading.

### 2. Trending Topics / Prompts Display

*   **Feature:** A section showcasing currently relevant or popular topics to encourage participation.
*   **Purpose:** Provides users with immediate, timely starting points for engaging in chat or survey activities.
*   **Function:**
    *   **Data Fetching (Server-Side):** Fetched within the main `/dashboard` page RSC. Uses Drizzle to query a `topics` table or derive topics based on recent activity/curation logic.
    *   **Caching:** This data is often the same for all users, making it a prime candidate for caching using **Upstash Redis** (e.g., `GET trending_topics`) with a short TTL (e.g., 1-5 minutes) or **Next.js `unstable_cache`** with time-based revalidation. This significantly reduces database load.
    *   **UI Rendering:** Displays topics as clickable links or cards within a dedicated section (e.g., using `map` in React). Links are configured to initiate a chat (`/chat?topic=...`) or filter the survey feed (`/survey?topic=...`).
*   **User Experience:** Users see relevant, current topics and can jump directly into participation with a single click.
*   **Performance:** Fast display due to server-side fetching and aggressive caching (Redis/`unstable_cache`).

### 3. Participation Entry Points

*   **Feature:** Clear, prominent buttons or links providing direct access to the core participation modes and insight exploration.
*   **Purpose:** Simplifies navigation and encourages users to engage with the platform's main features.
*   **Function:**
    *   **UI Implementation:** Implemented using standard navigation elements (`<Link>` component from `next/link`) within the dashboard's React component structure (likely within the main RSC or a layout component).
    *   **Targets:** Links point directly to `/chat` (for new chat), `/survey`, and `/explore`.
*   **User Experience:** Provides obvious, easy-to-find starting points for interacting with the platform.
*   **Performance:** Standard Next.js client-side navigation performance via `<Link>`, which prefetches routes for a near-instant transition feel.

### 4. User Activity Summary (Optional/P2)

*   **Feature:** Displays concise statistics summarizing the user's participation level (e.g., number of questions answered, chats completed).
*   **Purpose:** Provides users with feedback on their contribution and encourages continued engagement.
*   **Function:**
    *   **Data Fetching (Server-Side Recommended):** Requires backend logic to query `survey_responses` and potentially `chats` tables using Drizzle aggregate functions (`count()`), filtered by the authenticated `userId`.
    *   **Caching:** These user-specific aggregates can be cached using **Upstash Redis** (keyed by `userId`, e.g., `HGET user_stats:<userId> surveys_answered`) or **Next.js `unstable_cache`** (keyed by `userId`). Cache invalidation should occur after relevant actions (e.g., survey submission, chat completion).
    *   **UI:** Rendered within a dedicated dashboard card or section. Fetched server-side (RSC or `unstable_cache`) for optimal initial load.
*   **User Experience:** Users get a quick, quantitative sense of their activity on the platform.
*   **Performance:** Relies on efficient, indexed database queries for aggregation and effective caching (Redis/`unstable_cache`) to avoid repeated DB hits on every dashboard load.

### 5. Marketplace Earnings Snapshot

*   **Feature:** Displays the user's current accumulated, available earnings from participation in the Insights Marketplace.
*   **Purpose:** Provides immediate visibility into the value generated by the user's consented data contributions, reinforcing the platform's unique value proposition.
*   **Function:**
    *   **Data Fetching (Client-Side or Dynamic RSC):** This highly user-specific and potentially frequently updated data often requires fetching after the initial page load or via dynamic server rendering techniques.
        *   **Option A (Client Fetch):** A dedicated Client Component (`'use client'`) fetches the earnings total from a secure API endpoint (`/api/user/earnings`) or Server Action using hooks (`useEffect`, `useState`, potentially SWR/React Query). Displays loading/error states.
        *   **Option B (PPR/Dynamic RSC):** If using PPR or dynamic rendering, this component could be wrapped in `<Suspense>`, with the data fetched server-side closer to the component, potentially via a Server Action called during render (`use` hook).
    *   **Backend Logic:** The API endpoint/Server Action queries the `marketplace_earnings` ledger table (via Drizzle) for the authenticated user's pseudonym, summing pending amounts. This query needs to be efficient (indexed lookup on pseudonym).
    *   **UI:** Displays the current earnings value (e.g., "$X.XX available") and includes a direct link to the detailed `/account/earnings` page.
*   **User Experience:** Users see a clear, up-to-date snapshot of their potential marketplace earnings, enhancing motivation.
*   **Performance:** Client-side fetching (Option A) might slightly delay the display of earnings but keeps the initial page load faster. Dynamic server-side fetching (Option B) integrates better with Suspense/PPR but requires careful implementation. Backend query must be fast.

### 6. Quick Links

*   **Feature:** Direct links to important user account management areas.
*   **Purpose:** Provides convenient access to settings and detailed views without navigating through multiple menus.
*   **Function:**
    *   **UI Implementation:** Standard `<Link>` components within the dashboard layout pointing to:
        *   `/account/settings` (for profile details, password, and importantly, marketplace consent management).
        *   `/account/earnings` (for detailed marketplace earnings history and payout requests - P3).
*   **User Experience:** Saves users time by providing shortcuts to manage their account and related features.
*   **Performance:** Standard Next.js client-side navigation performance.